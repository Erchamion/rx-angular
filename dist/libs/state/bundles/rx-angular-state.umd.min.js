!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@rx-angular/state",["exports","@angular/core","rxjs","rxjs/operators"],t):t(((e=e||self)["rx-angular"]=e["rx-angular"]||{},e["rx-angular"].state={}),e.ng.core,e.rxjs,e.rxjs.operators)}(this,(function(e,t,r,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),u=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)u.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return u}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}function a(e){return e?1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}:r.noop}function s(e){return!!Array.isArray(e)&&(e.length>0&&e.every((function(e){return"function"==typeof e})))}function f(e){return!!Array.isArray(e)&&(e.length>0&&e.every((function(e){return"string"==typeof e})))}function l(e){return!!e&&("string"==typeof e||"symbol"==typeof e||"number"==typeof e)}function p(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.pipe(n.distinctUntilChanged(),(function(t){return s(e)?t.pipe(a(e)):t}),n.filter((function(e){return void 0!==e})),n.distinctUntilChanged(),n.shareReplay({bufferSize:1,refCount:!0}))}}var b=function(e,t){return e===t};function v(e,t){var r;if(Array.isArray(e)){var i=e,o=t||b;r=function(e,t){return i.some((function(r){return!o(e[r],t[r])}))}}else{var u=e;r=function(e,t){return Object.keys(u).some((function(r){return n=e[r],i=t[r],!((o=u[r])?o(n,i):b(n,i));var n,i,o}))}}return n.distinctUntilChanged((function(e,t){return!r(e,t)}))}var d=function(e,t){return i(i({},e),t)};var h=function(){function e(){this.subscription=new r.Subscription,this.accumulator=function(e,t,i){void 0===e&&(e=new r.Subject),void 0===t&&(t=new r.Subject),void 0===i&&(i=new r.BehaviorSubject(d));var o=r.merge(e.pipe(n.distinctUntilChanged(),n.mergeAll(),n.observeOn(r.queueScheduler)),t.pipe(n.observeOn(r.queueScheduler))).pipe(n.withLatestFrom(i.pipe(n.observeOn(r.queueScheduler))),n.scan((function(e,t){var r=u(t,2),n=r[0];return(0,r[1])(e,n)}),{}),n.tap((function(e){return a.state=e})),n.publish()),c=o.pipe(n.publishReplay(1)),a={state:{},signal$:o,state$:c,nextSlice:function(e){t.next(e)},nextSliceObservable:function(t){e.next(t)},nextAccumulator:function(e){i.next(e)},subscribe:function(){var e=a.signal$.connect();return e.add(a.state$.connect()),e}};return a}(),this.effectObservable=function(e){void 0===e&&(e=new r.Subject);var t=r.merge(e.pipe(n.mergeAll(),n.observeOn(r.queueScheduler)));return{effects$:t,nextEffectObservable:function(t){e.next(t)},subscribe:function(){return t.subscribe()}}}(),this.$=this.accumulator.signal$,this.subscription.add(this.subscribe())}return e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.setAccumulator=function(e){this.accumulator.nextAccumulator(e)},e.prototype.get=function(){return this.accumulator.state},e.prototype.set=function(e,t){if("object"!=typeof e||void 0!==t){if("function"!=typeof e||void 0!==t){if(l(e)&&"function"==typeof t){var r={};return r[e]=t(this.accumulator.state),void this.accumulator.nextSlice(r)}throw new Error("wrong params passed to set")}this.accumulator.nextSlice(e(this.accumulator.state))}else this.accumulator.nextSlice(e)},e.prototype.connect=function(e,t,o){var u=this;if(r.isObservable(e)&&void 0===t&&void 0===o){var c=e.pipe(n.filter((function(e){return void 0!==e})));this.accumulator.nextSliceObservable(c)}else if(!r.isObservable(e)||"function"!=typeof t||r.isObservable(t)||void 0!==o)if(l(e)&&r.isObservable(t)&&void 0===o){var a=e;c=t.pipe(n.filter((function(e){return void 0!==e})),n.map((function(e){var t;return i({},((t={})[a]=e,t))})));this.accumulator.nextSliceObservable(c)}else{if(!l(e)||!r.isObservable(t)||"function"!=typeof o)throw new Error("wrong params passed to connect");var s=e;c=t.pipe(n.filter((function(e){return void 0!==e})),n.map((function(e){var t;return i({},((t={})[s]=o(u.get(),e),t))})));this.accumulator.nextSliceObservable(c)}else{var f=t,c=e.pipe(n.filter((function(e){return void 0!==e})),n.map((function(e){return f(u.get(),e)})));this.accumulator.nextSliceObservable(c)}},e.prototype.select=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!e||0===e.length)return this.accumulator.state$.pipe(p());if(f(e))return this.accumulator.state$.pipe(p(n.pluck.apply(void 0,c(e))));if(s(e))return this.accumulator.state$.pipe(p(a(e)));throw new Error("wrong params passed to select")},e.prototype.hold=function(e,t){"function"!=typeof t?this.effectObservable.nextEffectObservable(e):this.effectObservable.nextEffectObservable(e.pipe(n.tap(t)))},e.prototype.subscribe=function(){var e=new r.Subscription;return e.add(this.accumulator.subscribe()),e.add(this.effectObservable.subscribe()),e},e=function(e,t,r,n){var i,o=arguments.length,u=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(u=(o<3?i(u):o>3?i(t,r,u):i(t,r))||u);return o>3&&u&&Object.defineProperty(t,r,u),u}([t.Injectable(),o("design:paramtypes",[])],e)}();e.RxState=h,e.distinctUntilSomeChanged=v,e.select=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){if(e&&0!==e.length){if(f(e))return t.pipe(p(n.pluck.apply(void 0,c(e))));if(s(e))return t.pipe(p(a(e)));throw new Error("wrong params passed to select")}return t.pipe(p())}},e.selectSlice=function(e,t){var r=Array.isArray(e)?e:Object.keys(e),i=Array.isArray(e)?v(e,t):v(e);return function(e){return e.pipe(n.map((function(e){return{definedKeys:r.filter((function(t){return e.hasOwnProperty(t)&&void 0!==e[t]})),state:e}})),n.filter((function(e){var t=e.definedKeys;e.state;return!!t.length})),n.map((function(e){var t=e.definedKeys,r=e.state;return t.filter((function(e){return r.hasOwnProperty(e)&&void 0!==r[e]})).reduce((function(e,t){return e[t]=r[t],e}),{})})),i)}},e.stateful=p,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rx-angular-state.umd.min.js.map