{"version":3,"file":"coalescing-manager.js","sourceRoot":"ng://@rx-angular/template/","sources":["lib/core/render-aware/coalescing-manager.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,uBAAuB,EAAE,MAAM,UAAU,CAAC;AAMnD,MAAM,8BAA8B,GAAG,uBAAuB,CAG5D,GAAG,CAAC,EAAE,CAAC,CAAC;IACR,wBAAwB,EAAE,CAAC;CAC5B,CAAC,CAAC,CAAC;AAEJ,MAAM,UAAU,qBAAqB,CACnC,QAAgB,EAAE;IAMlB,OAAO;QACL,MAAM,EAAE,gBAAgB;QACxB,GAAG,EAAE,eAAe;QACpB,YAAY;KACb,CAAC;IAEF,0EAA0E;IAC1E,SAAS,gBAAgB;QACvB,MAAM,wBAAwB,GAC5B,8BAA8B,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,wBAAwB;YACvE,CAAC,CAAC;QACJ,8BAA8B,CAAC,QAAQ,CAAC,KAAK,EAAE;YAC7C,wBAAwB;SACzB,CAAC,CAAC;IACL,CAAC;IAED,0EAA0E;IAC1E,SAAS,eAAe;QACtB,MAAM,wBAAwB,GAC5B,8BAA8B,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,wBAAwB;YACvE,CAAC,CAAC;QACJ,8BAA8B,CAAC,QAAQ,CAAC,KAAK,EAAE;YAC7C,wBAAwB;SACzB,CAAC,CAAC;IACL,CAAC;IAED,mDAAmD;IACnD,SAAS,YAAY;QACnB,OAAO,CACL,8BAA8B,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,wBAAwB;YACvE,CAAC,CACF,CAAC;IACJ,CAAC;AACH,CAAC","sourcesContent":["import { createPropertiesWeakMap } from '../utils';\r\n\r\ninterface CoalescingContextProps {\r\n  numCoalescingSubscribers: number;\r\n}\r\n\r\nconst coalescingContextPropertiesMap = createPropertiesWeakMap<\r\n  object,\r\n  CoalescingContextProps\r\n>(ctx => ({\r\n  numCoalescingSubscribers: 0\r\n}));\r\n\r\nexport function createCoalesceManager(\r\n  scope: object = {}\r\n): {\r\n  remove: () => void;\r\n  add: () => void;\r\n  isCoalescing: () => boolean;\r\n} {\r\n  return {\r\n    remove: removeSubscriber,\r\n    add: addSubscription,\r\n    isCoalescing\r\n  };\r\n\r\n  // Increments the number of subscriptions in a scope e.g. a class instance\r\n  function removeSubscriber(): void {\r\n    const numCoalescingSubscribers =\r\n      coalescingContextPropertiesMap.getProps(scope).numCoalescingSubscribers -\r\n      1;\r\n    coalescingContextPropertiesMap.setProps(scope, {\r\n      numCoalescingSubscribers\r\n    });\r\n  }\r\n\r\n  // Decrements the number of subscriptions in a scope e.g. a class instance\r\n  function addSubscription(): void {\r\n    const numCoalescingSubscribers =\r\n      coalescingContextPropertiesMap.getProps(scope).numCoalescingSubscribers +\r\n      1;\r\n    coalescingContextPropertiesMap.setProps(scope, {\r\n      numCoalescingSubscribers\r\n    });\r\n  }\r\n\r\n  // Checks if anybody else is already coalescing atm\r\n  function isCoalescing(): boolean {\r\n    return (\r\n      coalescingContextPropertiesMap.getProps(scope).numCoalescingSubscribers >\r\n      0\r\n    );\r\n  }\r\n}\r\n"]}